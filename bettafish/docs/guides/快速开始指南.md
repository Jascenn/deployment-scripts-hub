# BettaFish 快速开始指南

欢迎使用 BettaFish 部署工具！本指南将帮助您在 5 分钟内完成 BettaFish 的部署。

---

## 📋 前置要求

在开始之前，请确保您的系统满足以下要求：

### 系统要求

- **操作系统**: macOS 或 Linux
- **内存**: 建议 8GB 以上
- **磁盘空间**: 至少 20GB 可用空间

### 软件依赖

需要安装以下软件（脚本会自动检测并提示安装）：

1. **Docker Desktop** (推荐) 或 Docker Engine
   - macOS: [下载 Docker Desktop](https://www.docker.com/products/docker-desktop)
   - Linux: [安装 Docker Engine](https://docs.docker.com/engine/install/)

2. **Docker Compose** v2.0+
   - Docker Desktop 已内置
   - 独立安装: [Docker Compose 安装指南](https://docs.docker.com/compose/install/)

### API 密钥准备

您需要准备以下 API 密钥：

| API 密钥 | 必需性 | 用途 | 获取方式 |
|---------|--------|------|---------|
| **主 API 密钥** | ✅ 必填 | LLM 服务（7个引擎） | [VibeAI](https://vibecodingapi.ai/) |
| **Tavily 搜索密钥** | ⚠️ 推荐 | 网络搜索功能 | [Tavily](https://tavily.com/) |
| **Bocha 搜索密钥** | ⚠️ 可选 | 备用搜索服务 | [Bocha](https://bocha.ai/) |

---

## 🚀 快速部署（三步完成）

### 步骤 1: 获取部署工具包

```bash
# 下载部署工具包
cd ~/Downloads
unzip BettaFish-Deployment-Kit.zip
cd BettaFish-Deployment-Kit
```

### 步骤 2: 运行部署脚本

```bash
# 赋予执行权限
chmod +x docker-deploy.sh

# 运行部署脚本
./docker-deploy.sh
```

### 步骤 3: 按提示输入配置

脚本会引导您完成以下步骤：

#### 3.1 环境检测
```
▶ 步骤 1/7: 环境检测与依赖安装

ℹ️  检测 Docker...
✅ Docker 已安装 (版本: 24.0.6)

ℹ️  检测 Docker Compose...
✅ Docker Compose 已安装 (版本: 2.23.0)
```

#### 3.2 输入 API 密钥
```
▶ 步骤 3/7: 配置 API 密钥

请输入您的 API 配置信息:

主 API 密钥 [必填]: sk-proj-YOUR_API_KEY_HERE
Tavily API 密钥 [推荐]: tvly-YOUR_TAVILY_KEY_HERE
Bocha API 密钥 [可选]: (直接回车跳过)
```

#### 3.3 自动部署
```
▶ 步骤 5/7: 拉取 Docker 镜像

ℹ️  测试镜像源网络连接速度...
✅ 选择最快的镜像源: 官方镜像源 (180ms)

ℹ️  拉取镜像: ghcr.io/666ghj/bettafish:latest
[====================>] 100%

▶ 步骤 6/7: 启动服务

ℹ️  检测端口使用情况...
✅ 默认端口 5000 可用

ℹ️  使用 docker-compose 启动所有服务...
✅ 服务启动成功 (耗时: 5秒)
```

#### 3.4 部署完成
```
========================================
🎉 BettaFish 部署完成！
========================================

🌐 服务访问地址:

  ● BettaFish 主服务:       http://localhost:5000
  ● Insight Engine:        http://localhost:8501
  ● Media Engine:          http://localhost:8502
  ● Query Engine:          http://localhost:8503
  ● 数据库服务:            localhost:5432

📊 服务状态:

  ✓ bettafish        运行中
  ✓ bettafish-db     运行中

✅ 所有服务运行正常
```

---

## 🎯 访问服务

部署完成后，在浏览器中访问：

### 主服务
```
http://localhost:5000
```

这是 BettaFish 的主界面，您可以在这里：
- 创建和管理对话
- 使用各种 AI 引擎
- 查看历史记录

### Streamlit 引擎（可选）

如果需要单独使用某个引擎：

- **Insight Engine**: http://localhost:8501
- **Media Engine**: http://localhost:8502
- **Query Engine**: http://localhost:8503

---

## 🔄 日常使用

### 启动服务

如果服务已停止，重新启动：

```bash
cd ~/Downloads/BettaFish-Deployment-Kit/BettaFish-main
docker-compose up -d
```

### 停止服务

暂时停止服务：

```bash
cd ~/Downloads/BettaFish-Deployment-Kit/BettaFish-main
docker-compose stop
```

### 查看服务状态

```bash
cd ~/Downloads/BettaFish-Deployment-Kit/BettaFish-main
docker-compose ps
```

### 查看日志

```bash
cd ~/Downloads/BettaFish-Deployment-Kit/BettaFish-main

# 查看主服务日志
docker-compose logs -f bettafish

# 查看数据库日志
docker-compose logs -f db
```

---

## 🔧 常见问题

### 1. 部署脚本提示权限不足

**问题**：运行脚本时提示 "Permission denied"

**解决**：
```bash
chmod +x docker-deploy.sh
./docker-deploy.sh
```

### 2. 端口被占用

**问题**：提示端口 5000 已被占用

**解决**：脚本会自动查找可用端口（5001-5010）并修复，无需手动处理。

显示如下信息表示已自动修复：
```
⚠️  默认端口 5000 已被占用
✅ 找到可用端口: 5001
✅ 端口配置已更新: 5000 → 5001
```

访问地址会相应变更为 `http://localhost:5001`

### 3. 镜像下载缓慢

**问题**：镜像拉取速度很慢

**解决**：
- 脚本会自动测试并选择最快的镜像源（官方源或南京大学镜像）
- 如果两个源都很慢，可以尝试：
  1. 使用 VPN
  2. 等待网络条件改善后重试

### 4. 首次访问加载慢

**问题**：第一次访问服务时加载时间较长

**原因**：数据库初始化和模型加载需要时间

**解决**：请耐心等待 30-60 秒，后续访问会很快

### 5. 服务无法访问

**问题**：浏览器无法打开服务地址

**检查步骤**：
```bash
# 1. 确认容器运行状态
docker-compose ps

# 2. 检查容器日志
docker-compose logs bettafish

# 3. 检查端口监听
lsof -i :5000  # 或实际使用的端口
```

**可能原因**：
- 容器启动失败 → 查看日志排查
- 端口未正确映射 → 检查 docker-compose.yml
- 防火墙阻止 → 检查系统防火墙设置

---

## 📦 更新部署

### 更新到最新版本

```bash
cd ~/Downloads/BettaFish-Deployment-Kit

# 重新运行部署脚本
./docker-deploy.sh

# 选择使用现有配置
是否使用现有配置? [Y/n]: Y
```

脚本会自动：
1. 停止旧容器
2. 拉取最新镜像
3. 清理旧镜像
4. 启动新版本

### 保留数据

- **数据库数据**: 存储在 Docker Volume 中，更新不会丢失
- **配置文件**: 更新前会自动备份到 `backups/` 目录

---

## 🗑️ 完全卸载

如果需要完全移除 BettaFish：

```bash
cd ~/Downloads/BettaFish-Deployment-Kit/BettaFish-main

# 停止并删除容器
docker-compose down

# 删除数据卷（会清空数据库）
docker-compose down -v

# 删除镜像
docker rmi ghcr.io/666ghj/bettafish:latest
docker rmi postgres:15

# 删除部署工具包
cd ..
rm -rf BettaFish-Deployment-Kit
```

---

## 📞 获取帮助

### 查看详细文档

- **技术文档**: `docs/technical/技术文档.md`
- **故障排查**: `docs/guides/故障排查指南.md`
- **架构说明**: `docs/technical/核心架构.md`

### 查看部署日志

所有部署日志保存在：
```
BettaFish-Deployment-Kit/logs/deploy_YYYYMMDD_HHMMSS.log
```

### 查看备份文件

配置备份保存在：
```
BettaFish-Deployment-Kit/backups/
```

### 社区支持

- **GitHub Issues**: [报告问题](https://github.com/666ghj/BettaFish/issues)
- **讨论区**: [GitHub Discussions](https://github.com/666ghj/BettaFish/discussions)

---

## 🎓 下一步

现在您已经成功部署了 BettaFish！接下来可以：

1. ✅ 访问 http://localhost:5000 开始使用
2. 📖 阅读[用户手册](./用户手册.md)了解更多功能
3. 🔧 查看[技术文档](../technical/技术文档.md)了解高级配置
4. 🎨 探索不同的 AI 引擎功能

祝您使用愉快！
