# BettaFish æ•…éšœæ’æŸ¥æŒ‡å—

æœ¬æŒ‡å—å¸®åŠ©æ‚¨è¯Šæ–­å’Œè§£å†³ BettaFish éƒ¨ç½²å’Œè¿è¡Œè¿‡ç¨‹ä¸­å¯èƒ½é‡åˆ°çš„å¸¸è§é—®é¢˜ã€‚

---

## ğŸ“‹ ç›®å½•

1. [éƒ¨ç½²é˜¶æ®µé—®é¢˜](#éƒ¨ç½²é˜¶æ®µé—®é¢˜)
2. [è¿è¡Œæ—¶é—®é¢˜](#è¿è¡Œæ—¶é—®é¢˜)
3. [æ€§èƒ½é—®é¢˜](#æ€§èƒ½é—®é¢˜)
4. [ç½‘ç»œé—®é¢˜](#ç½‘ç»œé—®é¢˜)
5. [æ•°æ®åº“é—®é¢˜](#æ•°æ®åº“é—®é¢˜)
6. [æ—¥å¿—åˆ†æ](#æ—¥å¿—åˆ†æ)
7. [ç´§æ€¥æ¢å¤](#ç´§æ€¥æ¢å¤)

---

## ğŸš€ éƒ¨ç½²é˜¶æ®µé—®é¢˜

### é—®é¢˜ 1: è„šæœ¬æƒé™ä¸è¶³

**ç—‡çŠ¶**:
```bash
$ ./docker-deploy.sh
-bash: ./docker-deploy.sh: Permission denied
```

**åŸå› **: è„šæœ¬æ²¡æœ‰æ‰§è¡Œæƒé™

**è§£å†³æ–¹æ¡ˆ**:
```bash
# èµ‹äºˆæ‰§è¡Œæƒé™
chmod +x docker-deploy.sh

# é‡æ–°è¿è¡Œ
./docker-deploy.sh
```

---

### é—®é¢˜ 2: Docker æœªå®‰è£…æˆ–æœªå¯åŠ¨

**ç—‡çŠ¶**:
```
âŒ Docker æœªå®‰è£…æˆ–æœªè¿è¡Œ
```

**è¯Šæ–­**:
```bash
# æ£€æŸ¥ Docker æ˜¯å¦å®‰è£…
which docker

# æ£€æŸ¥ Docker æ˜¯å¦è¿è¡Œ
docker ps
```

**è§£å†³æ–¹æ¡ˆ**:

#### macOS:
```bash
# 1. ä¸‹è½½å¹¶å®‰è£… Docker Desktop
# è®¿é—®: https://www.docker.com/products/docker-desktop

# 2. å¯åŠ¨ Docker Desktop
open -a Docker

# 3. ç­‰å¾… Docker å®Œå…¨å¯åŠ¨ï¼ˆèœå•æ å›¾æ ‡æ˜¾ç¤ºè¿è¡Œä¸­ï¼‰
# 4. é‡æ–°è¿è¡Œéƒ¨ç½²è„šæœ¬
./docker-deploy.sh
```

#### Linux:
```bash
# Ubuntu/Debian
sudo apt update
sudo apt install docker.io docker-compose

# å¯åŠ¨ Docker æœåŠ¡
sudo systemctl start docker
sudo systemctl enable docker

# å°†å½“å‰ç”¨æˆ·åŠ å…¥ docker ç»„ï¼ˆé¿å…æ¯æ¬¡ä½¿ç”¨ sudoï¼‰
sudo usermod -aG docker $USER

# é‡æ–°ç™»å½•æˆ–è¿è¡Œ
newgrp docker

# é‡æ–°è¿è¡Œéƒ¨ç½²è„šæœ¬
./docker-deploy.sh
```

---

### é—®é¢˜ 3: Docker Compose ç‰ˆæœ¬è¿‡æ—§

**ç—‡çŠ¶**:
```
âš ï¸  Docker Compose ç‰ˆæœ¬è¿‡æ—§ (1.29.2)ï¼Œå»ºè®® 2.0.0+
```

**è¯Šæ–­**:
```bash
docker-compose version
```

**è§£å†³æ–¹æ¡ˆ**:

#### macOS (Docker Desktop):
```bash
# Docker Desktop å·²å†…ç½®æœ€æ–°ç‰ˆæœ¬ï¼Œæ›´æ–° Docker Desktop å³å¯
# è®¿é—®: Docker Desktop â†’ Settings â†’ Software Updates
```

#### Linux:
```bash
# å¸è½½æ—§ç‰ˆæœ¬
sudo apt remove docker-compose

# å®‰è£…æ–°ç‰ˆæœ¬
sudo curl -L "https://github.com/docker/compose/releases/latest/download/docker-compose-$(uname -s)-$(uname -m)" \
    -o /usr/local/bin/docker-compose

# èµ‹äºˆæ‰§è¡Œæƒé™
sudo chmod +x /usr/local/bin/docker-compose

# éªŒè¯ç‰ˆæœ¬
docker-compose --version
```

---

### é—®é¢˜ 4: ç«¯å£ 5000 è¢«å ç”¨

**ç—‡çŠ¶**:
```
âš ï¸  é»˜è®¤ç«¯å£ 5000 å·²è¢«å ç”¨
  å ç”¨è¿›ç¨‹: ControlCe 12345
```

**è¯Šæ–­**:
```bash
# macOS
lsof -i :5000

# Linux
netstat -tulpn | grep 5000
# æˆ–
ss -tulpn | grep 5000
```

**è§£å†³æ–¹æ¡ˆ**:

#### è‡ªåŠ¨ä¿®å¤ï¼ˆæ¨èï¼‰:
è„šæœ¬ä¼šè‡ªåŠ¨æŸ¥æ‰¾ 5001-5010 å¯ç”¨ç«¯å£å¹¶ä¿®å¤ï¼Œæ— éœ€æ‰‹åŠ¨æ“ä½œ

#### æ‰‹åŠ¨ä¿®å¤:
```bash
# æ–¹æ³• 1: åœæ­¢å ç”¨è¿›ç¨‹
# æ‰¾åˆ°è¿›ç¨‹ ID
lsof -i :5000
# åœæ­¢è¿›ç¨‹
kill -9 <PID>

# æ–¹æ³• 2: ä¿®æ”¹ BettaFish ä½¿ç”¨çš„ç«¯å£
cd BettaFish-main
vim docker-compose.yml

# ä¿®æ”¹ç«¯å£æ˜ å°„
ports:
  - "8080:5000"  # æ”¹ä¸º 8080 æˆ–å…¶ä»–å¯ç”¨ç«¯å£

# é‡æ–°éƒ¨ç½²
cd ..
./docker-deploy.sh
```

#### macOS AirPlay å ç”¨ 5000 ç«¯å£:
```bash
# å…³é—­ AirPlay Receiver
ç³»ç»Ÿè®¾ç½® â†’ é€šç”¨ â†’ éš”ç©ºæ’­æ”¾æ¥æ”¶å™¨ â†’ å…³é—­
```

---

### é—®é¢˜ 5: é•œåƒæ‹‰å–å¤±è´¥æˆ–ç¼“æ…¢

**ç—‡çŠ¶**:
```
ERROR: failed to pull image: timeout
```

**è¯Šæ–­**:
```bash
# æµ‹è¯•ç½‘ç»œè¿æ¥
curl -I https://ghcr.io

# æµ‹è¯•é•œåƒæºé€Ÿåº¦
time curl -I https://ghcr.io/v2/
time curl -I https://ghcr.nju.edu.cn/v2/
```

**è§£å†³æ–¹æ¡ˆ**:

#### æ–¹æ¡ˆ 1: ä½¿ç”¨è„šæœ¬è‡ªåŠ¨é€‰æ‹©æœ€å¿«æº
è„šæœ¬ä¼šè‡ªåŠ¨æµ‹é€Ÿå¹¶é€‰æ‹©æœ€å¿«çš„é•œåƒæº

#### æ–¹æ¡ˆ 2: æ‰‹åŠ¨æŒ‡å®šé•œåƒæº
```bash
cd BettaFish-main
vim docker-compose.yml

# ä¿®æ”¹é•œåƒæºä¸ºå—äº¬å¤§å­¦é•œåƒ
services:
  bettafish:
    image: ghcr.nju.edu.cn/666ghj/bettafish:latest

# ä¿å­˜åé‡æ–°æ‹‰å–
docker-compose pull
```

#### æ–¹æ¡ˆ 3: ä½¿ç”¨ä»£ç†
```bash
# é…ç½® Docker ä»£ç† (macOS)
# Docker Desktop â†’ Settings â†’ Resources â†’ Proxies
# å¯ç”¨ Manual proxy configuration
# HTTP Proxy: http://127.0.0.1:7890
# HTTPS Proxy: http://127.0.0.1:7890

# Linux é…ç½® Docker ä»£ç†
sudo mkdir -p /etc/systemd/system/docker.service.d
sudo tee /etc/systemd/system/docker.service.d/http-proxy.conf <<EOF
[Service]
Environment="HTTP_PROXY=http://127.0.0.1:7890"
Environment="HTTPS_PROXY=http://127.0.0.1:7890"
Environment="NO_PROXY=localhost,127.0.0.1"
EOF

sudo systemctl daemon-reload
sudo systemctl restart docker
```

---

### é—®é¢˜ 6: .env æ˜¯ç›®å½•è€Œéæ–‡ä»¶

**ç—‡çŠ¶**:
```
./docker-deploy.sh: line 1891: .env: Is a directory
```

**åŸå› **: `.env` è¢«è¯¯åˆ›å»ºä¸ºç›®å½•

**è§£å†³æ–¹æ¡ˆ**:
è„šæœ¬ä¼šè‡ªåŠ¨æ£€æµ‹å¹¶åˆ é™¤ `.env` ç›®å½•ï¼Œç„¶ååˆ›å»ºæ­£ç¡®çš„æ–‡ä»¶

**æ‰‹åŠ¨ä¿®å¤**:
```bash
cd BettaFish-main
rm -rf .env
cd ..
./docker-deploy.sh
```

---

### é—®é¢˜ 7: API å¯†é’¥æ ¼å¼é”™è¯¯

**ç—‡çŠ¶**:
```
âš ï¸  API å¯†é’¥æ ¼å¼å¯èƒ½ä¸æ­£ç¡®
```

**è¯Šæ–­**:
- ä¸» API å¯†é’¥åº”ä»¥ `sk-` å¼€å¤´
- Tavily å¯†é’¥åº”ä»¥ `tvly-` å¼€å¤´
- Bocha å¯†é’¥åº”ä»¥ `bocha-` å¼€å¤´

**è§£å†³æ–¹æ¡ˆ**:
```bash
# é‡æ–°è¿è¡Œéƒ¨ç½²è„šæœ¬
./docker-deploy.sh

# é€‰æ‹©é‡æ–°è¾“å…¥é…ç½®
æ˜¯å¦ä½¿ç”¨ç°æœ‰é…ç½®? [Y/n]: n

# è¾“å…¥æ­£ç¡®çš„ API å¯†é’¥
```

---

## ğŸƒ è¿è¡Œæ—¶é—®é¢˜

### é—®é¢˜ 8: å®¹å™¨å¯åŠ¨åç«‹å³é€€å‡º

**ç—‡çŠ¶**:
```bash
$ docker-compose ps
NAME            STATUS
bettafish       Exited (1) 2 seconds ago
```

**è¯Šæ–­**:
```bash
# æŸ¥çœ‹å®¹å™¨æ—¥å¿—
docker-compose logs bettafish

# æŸ¥çœ‹æœ€å 50 è¡Œ
docker-compose logs --tail=50 bettafish
```

**å¸¸è§åŸå› å’Œè§£å†³æ–¹æ¡ˆ**:

#### åŸå›  1: æ•°æ®åº“è¿æ¥å¤±è´¥
```bash
# æ—¥å¿—æ˜¾ç¤º: Connection refused: db:5432

# æ£€æŸ¥æ•°æ®åº“æ˜¯å¦è¿è¡Œ
docker-compose ps db

# å¦‚æœæ•°æ®åº“æœªè¿è¡Œï¼Œå¯åŠ¨æ•°æ®åº“
docker-compose up -d db

# ç­‰å¾…æ•°æ®åº“å°±ç»ª
sleep 10

# é‡å¯ä¸»æœåŠ¡
docker-compose restart bettafish
```

#### åŸå›  2: ç¯å¢ƒå˜é‡é…ç½®é”™è¯¯
```bash
# æ—¥å¿—æ˜¾ç¤º: KeyError: 'INSIGHT_ENGINE_API_KEY'

# æ£€æŸ¥ .env æ–‡ä»¶
cat BettaFish-main/.env

# é‡æ–°ç”Ÿæˆ .env
cd ..
./docker-deploy.sh
# é€‰æ‹©é‡æ–°è¾“å…¥é…ç½®
```

#### åŸå›  3: ç«¯å£å·²è¢«å ç”¨
```bash
# æ—¥å¿—æ˜¾ç¤º: Address already in use: 5000

# æŸ¥çœ‹ç«¯å£å ç”¨
lsof -i :5000

# åœæ­¢å ç”¨è¿›ç¨‹æˆ–ä¿®æ”¹ç«¯å£
# è§é—®é¢˜ 4 è§£å†³æ–¹æ¡ˆ
```

---

### é—®é¢˜ 9: æœåŠ¡æ— æ³•è®¿é—®

**ç—‡çŠ¶**:
æµè§ˆå™¨è®¿é—® `http://localhost:5000` æ˜¾ç¤ºæ— æ³•è¿æ¥

**è¯Šæ–­æ­¥éª¤**:

#### æ­¥éª¤ 1: æ£€æŸ¥å®¹å™¨çŠ¶æ€
```bash
docker-compose ps

# æœŸæœ›è¾“å‡º:
NAME            STATUS
bettafish       Up 5 minutes (healthy)
bettafish-db    Up 5 minutes (healthy)
```

#### æ­¥éª¤ 2: æ£€æŸ¥ç«¯å£æ˜ å°„
```bash
docker-compose port bettafish 5000

# æœŸæœ›è¾“å‡º: 0.0.0.0:5000 æˆ– 127.0.0.1:5000
```

#### æ­¥éª¤ 3: æµ‹è¯•æœ¬åœ°è¿æ¥
```bash
curl http://localhost:5000

# æˆ–æŒ‡å®š IP
curl http://127.0.0.1:5000
```

#### æ­¥éª¤ 4: æ£€æŸ¥é˜²ç«å¢™
```bash
# macOS
sudo /usr/libexec/ApplicationFirewall/socketfilterfw --getglobalstate

# Linux (ufw)
sudo ufw status

# å¦‚æœé˜»æ­¢äº†è¿æ¥ï¼Œæ·»åŠ è§„åˆ™
sudo ufw allow 5000/tcp
```

**è§£å†³æ–¹æ¡ˆ**:

#### å®¹å™¨æœªè¿è¡Œ:
```bash
docker-compose up -d
```

#### ç«¯å£æ˜ å°„é”™è¯¯:
```bash
# æ£€æŸ¥ docker-compose.yml
cat BettaFish-main/docker-compose.yml | grep -A 5 ports

# ç¡®è®¤ç«¯å£æ˜ å°„æ­£ç¡®:
#   - "5000:5000"
```

#### æœåŠ¡å¯åŠ¨ä¸­:
```bash
# ç­‰å¾… 30-60 ç§’ï¼ŒæœåŠ¡å¯èƒ½è¿˜åœ¨åˆå§‹åŒ–
# æŸ¥çœ‹æ—¥å¿—ç¡®è®¤å¯åŠ¨è¿›åº¦
docker-compose logs -f bettafish
```

---

### é—®é¢˜ 10: Streamlit UI æ— æ³•è®¿é—®

**ç—‡çŠ¶**:
ä¸»æœåŠ¡å¯è®¿é—®ï¼Œä½† `http://localhost:8501` æ— æ³•æ‰“å¼€

**è¯Šæ–­**:
```bash
# æ£€æŸ¥ç«¯å£æ˜ å°„
docker-compose port bettafish 8501
docker-compose port bettafish 8502
docker-compose port bettafish 8503

# æŸ¥çœ‹å®¹å™¨å†…è¿›ç¨‹
docker-compose exec bettafish ps aux | grep streamlit
```

**è§£å†³æ–¹æ¡ˆ**:

#### ç«¯å£æœªæ­£ç¡®æ˜ å°„:
```bash
# ç¼–è¾‘ docker-compose.yml
cd BettaFish-main
vim docker-compose.yml

# ç¡®è®¤åŒ…å«ä»¥ä¸‹ç«¯å£æ˜ å°„
ports:
  - "5000:5000"
  - "8501:8501"
  - "8502:8502"
  - "8503:8503"

# é‡å¯æœåŠ¡
docker-compose restart bettafish
```

#### Streamlit è¿›ç¨‹æœªå¯åŠ¨:
```bash
# è¿›å…¥å®¹å™¨æ£€æŸ¥
docker-compose exec bettafish bash

# æ‰‹åŠ¨å¯åŠ¨ Streamlit (è°ƒè¯•ç”¨)
streamlit run streamlit_apps/insight_ui.py --server.port 8501
```

---

### é—®é¢˜ 11: API è°ƒç”¨å¤±è´¥

**ç—‡çŠ¶**:
```
Error: 401 Unauthorized
Error: Invalid API Key
```

**è¯Šæ–­**:
```bash
# æ£€æŸ¥ .env æ–‡ä»¶ä¸­çš„ API å¯†é’¥
cd BettaFish-main
grep "API_KEY" .env

# æµ‹è¯• API å¯†é’¥
curl -H "Authorization: Bearer sk-proj-YOUR_KEY" \
    https://vibecodingapi.ai/v1/models
```

**è§£å†³æ–¹æ¡ˆ**:

#### å¯†é’¥é”™è¯¯æˆ–è¿‡æœŸ:
```bash
# é‡æ–°ç”Ÿæˆ .env
cd ..
./docker-deploy.sh

# é€‰æ‹©é‡æ–°è¾“å…¥é…ç½®
æ˜¯å¦ä½¿ç”¨ç°æœ‰é…ç½®? [Y/n]: n

# è¾“å…¥æ–°çš„ API å¯†é’¥
```

#### Base URL é…ç½®é”™è¯¯:
```bash
# ç¼–è¾‘ .env
cd BettaFish-main
vim .env

# ç¡®è®¤æ‰€æœ‰å¼•æ“çš„ BASE_URL æ­£ç¡®:
INSIGHT_ENGINE_BASE_URL=https://vibecodingapi.ai/v1
MEDIA_ENGINE_BASE_URL=https://vibecodingapi.ai/v1
# ... å…¶ä»–å¼•æ“

# é‡å¯æœåŠ¡
docker-compose restart bettafish
```

---

## âš¡ æ€§èƒ½é—®é¢˜

### é—®é¢˜ 12: æœåŠ¡å“åº”ç¼“æ…¢

**ç—‡çŠ¶**:
- é¡µé¢åŠ è½½æ—¶é—´è¶…è¿‡ 10 ç§’
- API è¯·æ±‚è¶…æ—¶

**è¯Šæ–­**:
```bash
# æ£€æŸ¥èµ„æºä½¿ç”¨
docker stats

# æŸ¥çœ‹è¾“å‡ºç¤ºä¾‹:
CONTAINER     CPU %    MEM USAGE / LIMIT
bettafish     95.23%   3.8GiB / 4GiB       # CPU å’Œå†…å­˜æ¥è¿‘ä¸Šé™
bettafish-db  12.87%   512MiB / 2GiB
```

**è§£å†³æ–¹æ¡ˆ**:

#### å¢åŠ èµ„æºé™åˆ¶:
```bash
cd BettaFish-main
vim docker-compose.yml

# æ·»åŠ èµ„æºé…ç½®
services:
  bettafish:
    deploy:
      resources:
        limits:
          cpus: '4.0'      # å¢åŠ  CPU
          memory: 8G       # å¢åŠ å†…å­˜

# é‡å¯æœåŠ¡
docker-compose up -d
```

#### ä¼˜åŒ–æ•°æ®åº“:
```bash
# è¿›å…¥æ•°æ®åº“å®¹å™¨
docker-compose exec db psql -U bettafish bettafish

# åˆ†æè¡¨ç»Ÿè®¡ä¿¡æ¯
ANALYZE;

# æ¸…ç†æ— ç”¨æ•°æ®
VACUUM;

# é€€å‡º
\q
```

#### æ¸…ç† Docker ç¼“å­˜:
```bash
# æ¸…ç†æœªä½¿ç”¨çš„é•œåƒ
docker image prune -a

# æ¸…ç†æœªä½¿ç”¨çš„å®¹å™¨
docker container prune

# æ¸…ç†æœªä½¿ç”¨çš„æ•°æ®å·
docker volume prune

# æˆ–ä¸€æ¬¡æ€§æ¸…ç†æ‰€æœ‰
docker system prune -a
```

---

### é—®é¢˜ 13: ç£ç›˜ç©ºé—´ä¸è¶³

**ç—‡çŠ¶**:
```
Error: No space left on device
```

**è¯Šæ–­**:
```bash
# æ£€æŸ¥ç£ç›˜ä½¿ç”¨
df -h

# æ£€æŸ¥ Docker ç£ç›˜ä½¿ç”¨
docker system df

# æŸ¥çœ‹è¯¦ç»†ä¿¡æ¯
docker system df -v
```

**è§£å†³æ–¹æ¡ˆ**:

#### æ¸…ç†æ—§é•œåƒ:
```bash
# è„šæœ¬ä¼šè‡ªåŠ¨æ¸…ç†ï¼Œæ‰‹åŠ¨è¿è¡Œ:
docker images | grep bettafish
docker rmi <IMAGE_ID>

# æ¸…ç†æ‰€æœ‰æ‚¬æŒ‚é•œåƒ
docker image prune -f
```

#### æ¸…ç†æ—§æ—¥å¿—å’Œå¤‡ä»½:
```bash
# æ¸…ç† 30 å¤©å‰çš„æ—¥å¿—
find logs/ -name "*.log" -mtime +30 -delete

# æ¸…ç† 30 å¤©å‰çš„å¤‡ä»½
find backups/ -name "*.env" -mtime +30 -delete
find backups/ -name "*.yml" -mtime +30 -delete
```

#### é™åˆ¶æ—¥å¿—å¤§å°:
```bash
cd BettaFish-main
vim docker-compose.yml

# æ·»åŠ æ—¥å¿—é…ç½®
services:
  bettafish:
    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "3"
```

---

## ğŸŒ ç½‘ç»œé—®é¢˜

### é—®é¢˜ 14: å®¹å™¨é—´æ— æ³•é€šä¿¡

**ç—‡çŠ¶**:
ä¸»æœåŠ¡æ— æ³•è¿æ¥æ•°æ®åº“

**è¯Šæ–­**:
```bash
# æ£€æŸ¥ç½‘ç»œ
docker network ls
docker network inspect bettafish-network

# ä»ä¸»å®¹å™¨ ping æ•°æ®åº“
docker-compose exec bettafish ping db
```

**è§£å†³æ–¹æ¡ˆ**:

#### é‡å»ºç½‘ç»œ:
```bash
# åœæ­¢æœåŠ¡
docker-compose down

# åˆ é™¤ç½‘ç»œ
docker network rm bettafish-network

# é‡æ–°å¯åŠ¨ï¼ˆä¼šè‡ªåŠ¨åˆ›å»ºç½‘ç»œï¼‰
docker-compose up -d
```

#### æ£€æŸ¥é˜²ç«å¢™:
```bash
# Linux æ£€æŸ¥ iptables
sudo iptables -L -n

# å¦‚æœè¿‡äºä¸¥æ ¼ï¼Œä¸´æ—¶ç¦ç”¨æµ‹è¯•
sudo iptables -F  # æ…ç”¨ï¼
```

---

### é—®é¢˜ 15: DNS è§£æå¤±è´¥

**ç—‡çŠ¶**:
```
Error: Temporary failure in name resolution
```

**è¯Šæ–­**:
```bash
# è¿›å…¥å®¹å™¨æµ‹è¯• DNS
docker-compose exec bettafish bash
nslookup google.com
ping google.com
```

**è§£å†³æ–¹æ¡ˆ**:

#### é…ç½® DNS:
```bash
cd BettaFish-main
vim docker-compose.yml

# æ·»åŠ  DNS é…ç½®
services:
  bettafish:
    dns:
      - 8.8.8.8
      - 8.8.4.4

# é‡å¯æœåŠ¡
docker-compose restart
```

---

## ğŸ’¾ æ•°æ®åº“é—®é¢˜

### é—®é¢˜ 16: æ•°æ®åº“è¿æ¥å¤±è´¥

**ç—‡çŠ¶**:
```
Error: could not connect to server: Connection refused
```

**è¯Šæ–­**:
```bash
# æ£€æŸ¥æ•°æ®åº“çŠ¶æ€
docker-compose ps db

# æ£€æŸ¥æ•°æ®åº“æ—¥å¿—
docker-compose logs db

# æµ‹è¯•è¿æ¥
docker-compose exec db pg_isready -U bettafish
```

**è§£å†³æ–¹æ¡ˆ**:

#### æ•°æ®åº“æœªå¯åŠ¨:
```bash
docker-compose up -d db
sleep 10  # ç­‰å¾…å¯åŠ¨å®Œæˆ
docker-compose restart bettafish
```

#### å¯†ç é”™è¯¯:
```bash
# æ£€æŸ¥ .env ä¸­çš„å¯†ç 
grep DB_PASSWORD BettaFish-main/.env

# è¿›å…¥æ•°æ®åº“å®¹å™¨é‡ç½®å¯†ç 
docker-compose exec db psql -U bettafish -c \
    "ALTER USER bettafish WITH PASSWORD 'new_password';"

# æ›´æ–° .env
vim BettaFish-main/.env
# ä¿®æ”¹ DB_PASSWORD=new_password

# é‡å¯æœåŠ¡
docker-compose restart bettafish
```

---

### é—®é¢˜ 17: æ•°æ®åº“æ•°æ®ä¸¢å¤±

**ç—‡çŠ¶**:
é‡å¯åæ‰€æœ‰å¯¹è¯è®°å½•æ¶ˆå¤±

**è¯Šæ–­**:
```bash
# æ£€æŸ¥æ•°æ®å·
docker volume ls | grep bettafish

# æ£€æŸ¥æ•°æ®å·è¯¦æƒ…
docker volume inspect bettafish_db_data
```

**åŸå› **:
ä½¿ç”¨äº† `docker-compose down -v` åˆ é™¤äº†æ•°æ®å·

**è§£å†³æ–¹æ¡ˆ**:

#### ä»å¤‡ä»½æ¢å¤:
```bash
# å¦‚æœæœ‰æ•°æ®åº“å¤‡ä»½
cd BettaFish-main
docker-compose exec -T db psql -U bettafish bettafish < backup.sql
```

#### é¢„é˜²æªæ–½:
```bash
# å®šæœŸå¤‡ä»½æ•°æ®åº“
docker-compose exec db pg_dump -U bettafish bettafish > \
    backup_$(date +%Y%m%d).sql

# åœæ­¢æœåŠ¡æ—¶ä¸è¦ä½¿ç”¨ -v å‚æ•°
docker-compose down     # æ­£ç¡®
# docker-compose down -v  # é”™è¯¯ï¼ä¼šåˆ é™¤æ•°æ®
```

---

## ğŸ“ æ—¥å¿—åˆ†æ

### æŸ¥çœ‹ä¸åŒç±»å‹çš„æ—¥å¿—

#### éƒ¨ç½²æ—¥å¿—:
```bash
# æŸ¥çœ‹æœ€è¿‘çš„éƒ¨ç½²æ—¥å¿—
ls -lt logs/deploy_*.log | head -1
cat logs/deploy_$(ls -t logs/deploy_*.log | head -1)
```

#### å®¹å™¨æ—¥å¿—:
```bash
# ä¸»æœåŠ¡æ—¥å¿—
docker-compose logs bettafish

# æ•°æ®åº“æ—¥å¿—
docker-compose logs db

# å®æ—¶è·Ÿè¸ªæ—¥å¿—
docker-compose logs -f bettafish

# æŸ¥çœ‹æœ€å 100 è¡Œ
docker-compose logs --tail=100 bettafish

# æŸ¥çœ‹ç‰¹å®šæ—¶é—´èŒƒå›´
docker-compose logs --since 2025-01-14T10:00:00 bettafish
```

### å¸¸è§æ—¥å¿—é”™è¯¯æ¨¡å¼

#### é”™è¯¯ 1: æ¨¡å—å¯¼å…¥å¤±è´¥
```
ModuleNotFoundError: No module named 'xxx'
```
**è§£å†³**: é‡æ–°æ‹‰å–é•œåƒ `docker-compose pull`

#### é”™è¯¯ 2: ç«¯å£ç»‘å®šå¤±è´¥
```
OSError: [Errno 48] Address already in use
```
**è§£å†³**: è§é—®é¢˜ 4

#### é”™è¯¯ 3: æ•°æ®åº“è¿ç§»å¤±è´¥
```
alembic.util.exc.CommandError: Can't locate revision
```
**è§£å†³**: é‡æ–°åˆå§‹åŒ–æ•°æ®åº“

---

## ğŸ†˜ ç´§æ€¥æ¢å¤

### å®Œå…¨é‡ç½®éƒ¨ç½²

**è­¦å‘Š**: è¿™ä¼šåˆ é™¤æ‰€æœ‰æ•°æ®ï¼

```bash
cd BettaFish-Deployment-Kit/BettaFish-main

# 1. åœæ­¢å¹¶åˆ é™¤æ‰€æœ‰å®¹å™¨
docker-compose down

# 2. åˆ é™¤æ•°æ®å·ï¼ˆæ•°æ®ä¼šä¸¢å¤±ï¼ï¼‰
docker-compose down -v

# 3. åˆ é™¤é•œåƒ
docker rmi ghcr.io/666ghj/bettafish:latest
docker rmi postgres:15

# 4. æ¸…ç†é…ç½®
rm -f .env

# 5. é‡æ–°éƒ¨ç½²
cd ..
./docker-deploy.sh
```

### ä»å¤‡ä»½æ¢å¤é…ç½®

```bash
# 1. æŸ¥çœ‹å¯ç”¨å¤‡ä»½
ls -lt backups/

# 2. æ¢å¤ .env
cp backups/env_backup_20250114_143025.env \
   BettaFish-main/.env

# 3. æ¢å¤ docker-compose.yml (å¦‚éœ€è¦)
cp backups/docker-compose_backup_20250114_143030.yml \
   BettaFish-main/docker-compose.yml

# 4. é‡å¯æœåŠ¡
cd BettaFish-main
docker-compose up -d
```

### ä»æ•°æ®åº“å¤‡ä»½æ¢å¤

```bash
# 1. ç¡®ä¿æœåŠ¡è¿è¡Œ
docker-compose up -d db

# 2. æ¢å¤æ•°æ®
docker-compose exec -T db psql -U bettafish bettafish < backup.sql

# 3. é‡å¯ä¸»æœåŠ¡
docker-compose restart bettafish
```

---

## ğŸ“ è·å–æ›´å¤šå¸®åŠ©

### æ”¶é›†è¯Šæ–­ä¿¡æ¯

åˆ›å»ºè¯Šæ–­æŠ¥å‘Šä»¥ä¾¿å¯»æ±‚å¸®åŠ©:

```bash
#!/bin/bash
# åˆ›å»ºè¯Šæ–­æŠ¥å‘Š

REPORT_FILE="diagnostic_report_$(date +%Y%m%d_%H%M%S).txt"

{
    echo "========== ç³»ç»Ÿä¿¡æ¯ =========="
    uname -a
    echo ""

    echo "========== Docker ç‰ˆæœ¬ =========="
    docker --version
    docker-compose --version
    echo ""

    echo "========== å®¹å™¨çŠ¶æ€ =========="
    docker-compose ps
    echo ""

    echo "========== é•œåƒåˆ—è¡¨ =========="
    docker images | grep bettafish
    echo ""

    echo "========== æ•°æ®å· =========="
    docker volume ls | grep bettafish
    echo ""

    echo "========== ç½‘ç»œ =========="
    docker network ls | grep bettafish
    echo ""

    echo "========== èµ„æºä½¿ç”¨ =========="
    docker stats --no-stream
    echo ""

    echo "========== ä¸»æœåŠ¡æ—¥å¿—ï¼ˆæœ€å 50 è¡Œï¼‰=========="
    docker-compose logs --tail=50 bettafish
    echo ""

    echo "========== æ•°æ®åº“æ—¥å¿—ï¼ˆæœ€å 50 è¡Œï¼‰=========="
    docker-compose logs --tail=50 db
    echo ""

} > "$REPORT_FILE"

echo "è¯Šæ–­æŠ¥å‘Šå·²ä¿å­˜åˆ°: $REPORT_FILE"
```

### è”ç³»æ”¯æŒ

- **GitHub Issues**: [æŠ¥å‘Šé—®é¢˜](https://github.com/666ghj/BettaFish/issues)
- **è®¨è®ºåŒº**: [ç¤¾åŒºè®¨è®º](https://github.com/666ghj/BettaFish/discussions)

æäº¤é—®é¢˜æ—¶è¯·é™„ä¸Š:
1. è¯Šæ–­æŠ¥å‘Š
2. é—®é¢˜è¯¦ç»†æè¿°
3. é‡ç°æ­¥éª¤
4. éƒ¨ç½²æ—¥å¿—

---

**æ–‡æ¡£ç‰ˆæœ¬**: 2.0
**æœ€åæ›´æ–°**: 2025-01-14
**ç»´æŠ¤è€…**: BettaFish å¼€å‘å›¢é˜Ÿ
